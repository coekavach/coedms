<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kavach Documents</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        .tab-container {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            margin-bottom: 10px;
        }

        .tab-container button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        .tab-container button:hover {
            background-color: #ddd;
        }

        .tab-container button.active {
            background-color: #ccc;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 15px 12px;
            border: 1px solid #ccc;
            border-top: none;
            background-color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 14px;
        }

        th {
            background-color: #e9e9e9;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .loader {
            border: 5px solid #f3f3f3; /* Light grey */
            border-top: 5px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <h1>Kavach Related Documents</h1>

    <div class="tab-container">
        <button class="tab-button" id="defaultOpen" onclick="openTab(event, 'RDSO')">RDSO</button>
        <button class="tab-button" onclick="openTab(event, 'RailwayBoard')">Railway Board</button>
    </div>

    <div id="RDSO" class="tab-content">
        <h2>RDSO Specifications & Test Formats</h2>
        <div class="loader" id="loaderRDSO"></div>
        <table id="rdsoTable">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="RailwayBoard" class="tab-content">
        <h2>Railway Board Policy Letters & Circulars</h2>
        <div class="loader" id="loaderRailwayBoard"></div>
        <table id="railwayBoardTable">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        function openTab(evt, tabId) {
            var i, tabcontent, tabbuttons;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tabbuttons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
            }
            document.getElementById(tabId).style.display = "block";
            if (evt) { // Check if evt is passed (not for initial default open)
                evt.currentTarget.className += " active";
            } else { // For initial default open
                 document.getElementById('defaultOpen').className += " active";
            }
        }

        // Simple CSV parser
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(header => header.trim().replace(/^"|"$/g, '')); // Remove surrounding quotes if any
            const rows = [];

            for (let i = 1; i < lines.length; i++) {
                const values = [];
                let currentLine = lines[i];
                let inQuotes = false;
                let currentValue = '';

                // More robust splitting to handle commas within quotes
                for (let char of currentLine) {
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(currentValue.trim().replace(/^"|"$/g, ''));
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                values.push(currentValue.trim().replace(/^"|"$/g, '')); // Add the last value

                if (values.length === headers.length) { // Ensure data row matches header count
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    rows.push(row);
                }
            }
            return { headers, rows };
        }

        async function fetchAndDisplayCSV(gid, tableElementId, loaderElementId, tabName) {
            const sheetUrl = `https://docs.google.com/spreadsheets/d/e/2PACX-1vSlXoH4ekrswe0-BRLB4ZSx8cGjn-3OK-BGcvStNnuOKALm9IfakG4NTOLcYVM6dE7GgQx2f4qNEMDp/pub?gid=${gid}&single=true&output=csv&_=${new Date().getTime()}`; // Cache buster
            const table = document.getElementById(tableElementId);
            const loader = document.getElementById(loaderElementId);
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');

            thead.innerHTML = ''; // Clear previous headers
            tbody.innerHTML = ''; // Clear previous content
            loader.style.display = 'block'; // Show loader

            try {
                const response = await fetch(sheetUrl);
                if (!response.ok) {
                    throw new Error(`Network response was not ok for ${tabName}: ${response.statusText}`);
                }
                const csvText = await response.text();
                const { headers, rows } = parseCSV(csvText);

                // Populate headers
                const headerRow = document.createElement('tr');
                headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.textContent = headerText;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                // Populate rows
                rows.forEach(rowData => {
                    const tr = document.createElement('tr');
                    headers.forEach(header => {
                        const td = document.createElement('td');
                        const cellData = rowData[header] || ''; // Handle undefined data
                        // If the column is "Title" or "Letter No.", treat content as HTML for links
                        if (header.toLowerCase() === 'title' || header.toLowerCase() === 'letter no.' || header.toLowerCase() === 'reference') {
                           td.innerHTML = cellData; // Allow HTML for links
                        } else {
                           td.textContent = cellData;
                        }
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

            } catch (error) {
                console.error(`Error fetching or parsing CSV for ${tabName}:`, error);
                tbody.innerHTML = `<tr><td colspan="${thead.firstChild ? thead.firstChild.children.length : 1}" style="color:red; text-align:center;">Failed to load data for ${tabName}. ${error.message}</td></tr>`;
            } finally {
                loader.style.display = 'none'; // Hide loader
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchAndDisplayCSV(0, 'rdsoTable', 'loaderRDSO', 'RDSO'); // GID for RDSO sheet
            fetchAndDisplayCSV(737400844, 'railwayBoardTable', 'loaderRailwayBoard', 'Railway Board'); // GID for Railway Board sheet
            
            // Open the default tab
            openTab(null, 'RDSO'); // Pass null for event as it's a programmatic click
        });

    </script>

</body>
</html>
